# vim:ft=ansible:

---
- shell: git --version | grep 2.5.0
  register: version_check
  ignore_errors: yes

- name: install dependent packages
  command: apt-get -y install libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev
  when: version_check|failed

- name: install old version git
  command: apt-get -y install git
  when: version_check|failed

- shell: ls /usr/local/src/git
  register: exist_check
  ignore_errors: yes
  when: version_check|failed

- name: clone git
  command:
    git clone https://github.com/git/git.git /usr/local/src/git
  when: exist_check|failed

- name: uninstall old version git
  command: apt-get -y remove git
  when: version_check|failed

- name: compile & install
  shell:
    chdir=/usr/local/src/git
    make prefix=/usr/local all && make prefix=/usr/local install
  when: version_check|failed

